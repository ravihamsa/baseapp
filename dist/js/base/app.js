define(["require","base/router","base/dataLoader","base/util","base/formatter","base/model"],function(e,t,n,r,i,s){function u(e){var t,n=305419896,r=1,i=e.length+1;for(t=r;t<i;t++)n+=e.charCodeAt(t-1)*t;return n}var o=window.hex_md5,a=function(e){return u(e.toString())},f=function(e){return h[e]},l=function(e,t){if(p[t]&&p[t][e])return p[t][e]},c=function(e){p[e]&&(console.log("clearing cache for id",e),delete p[e])},h={},p={},d={root:"/",baseUrl:"js/",defaultApp:"default",appBody:"#app-body",compileTemplate:function(e){return Handlebars.compile(e)},router:new t,getTemplateDef:function(t){var n=this;t=t||"";var r=a(t),i=f(r);return i||(i=$.Deferred(),n.cacheTemplate(i,r),typeof t=="function"?i.resolve(t):typeof t=="string"&&(/html$/.test(t)?e(["text!"+t],function(e){i.resolve(n.compileTemplate(e))}):t.indexOf("#")===0?i.resolve(n.compileTemplate($(t).html())):i.resolve(n.compileTemplate(t)))),i},cacheTemplate:function(e,t){h[t]=e},cacheData:function(e,t,n){p[n]||(p[n]=[]),p[n][t]=e},log:function(){console.log.apply(console,arguments)},getString:function(e){return e},escapeString:function(e){return Handlebars.Utils.escapeExpression(e)},parseSuccessResponse:function(e){return e},parseFailureResponse:function(e){return e},appModel:new s,getRequestDef:function(e){var t=this,r=n.getConfig(e.id);r.paramsParser=r.paramsParser||_.identity;var i=t.parseSuccessResponse,s=t.parseFailureResponse;r.responseParser&&(i=s=r.responseParser),r.cacheDependencies&&_.each(r.cacheDependencies,function(e){c(e)}),e.params=r.paramsParser(e.params);var o=a(JSON.stringify(_.pick(e,"id","params"))),u=l(o,e.id);if(!u){u=$.Deferred();var f=n.getRequest(e.id,e.params);f.done(function(n){var s=i(n);s.errors&&s.errors.length>0?u.resolve(s.errors):(r.cache==="session"&&t.cacheData(u,o,e.id),u.resolve(s))}),f.fail(function(e){u.resolve({errors:[{errorCode:"network issue",message:"Network failure try again later"}]})})}return u},beautifyId:function(e){return e=e.replace(/_([a-z])/g,function(e){return e.toUpperCase()}),e=e.replace(/_/g,""),e=e.replace(/([A-Z])/g,function(e){return" "+e}),e.replace(/(^.)/g,function(e){return e.toUpperCase()})},getDataIndex:function(){return p},getTemplateIndex:function(){return h},getFormatted:function(e,t,n){if(typeof t=="function")return t.apply(null,arguments);var r=v[t];return r?r(e,n):e},addFormatter:function(e,t){if(v[e])throw new Error("formatter already exist");this.setFormatter.apply(null,arguments)},setFormatter:function(e,t){v[e]=t},getUrl:function(e,t,n){return"#"+e+"/"+t+"/"+r.objectToParams(n)},navigateToPage:function(e,t,n){d.router.navigate(d.getUrl.apply(d,arguments),{trigger:!0})},getHash:a,getPageAttributes:function(){return this.appModel.toJSON()},getPageAttribute:function(e){return this.appModel.get(e)}},v={};return d});