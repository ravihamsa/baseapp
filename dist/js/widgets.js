define("widgets/form/validator",["base/app"],function(e){var t=function(e,t){var r=[],i,s=_.every(t,function(t){var s=n[t.expr].call(this,t,e);return s||(r.push(t),i=t),s});return{isValid:s,errors:r,errorRule:i}},n={req:function(e,t){return!_.isEmpty(t)},digits:function(e,t){return/^\d{5}$/.test(t)},alphanumeric:function(e,t){var n=/^\w+$/;return n.test(t)},number:function(e,t){if(t===undefined)return!0;var n=+t;return n===n},email:function(e,t){var n=/^([\w\-]+(?:\.[\w\-]+)*)@((?:[\w\-]+\.)*\w[\w\-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return n.test($.trim(t))},minlen:function(e,t){var n=e.length;return $.trim(String(t)).length>=n},maxlen:function(e,t,n){var r=e.length;return $.trim(String(t)).length<=r},lt:function(e,t,n){var r=parseFloat(n),i=parseFloat(t);return i<r},gt:function(e,t,n){var r=parseFloat(n),i=parseFloat(t);return i>r},eq:function(e,t,n){return n===t},neq:function(e,t){return e.value!==t},url:function(e,t){if(t==="")return!0;var n=/(http|https|market):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/i;return n.test($.trim(t))},emaillist:function(e,t){var n=t.split(","),r=/^([\w\-]+(?:\.[\w\-]+)*)@((?:[\w\-]+\.)*\w[\w\-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;for(var i=0;i<n.length;i++)if($.trim(n[i])!==""&&!r.test($.trim(n[i])))return!1;return!0},"function":function(e,t){var n=e.func;return n.call(null,t)}};return{validateValue:t,validationRuleMethods:n}}),define("text!widgets/form/inputView.html",[],function(){return'<div class="control-group">\n    <label class="control-label">\n        {{elementLabel this}}\n    </label>\n\n    <div class="controls type-{{type}}">\n        <input type="{{type}}" name="{{name}}" value="{{value}}" placeholder="{{placeholder}}" class="el-{{name}}"/>\n        <span class="help-inline"></span>\n    </div>\n</div>'}),define("widgets/form/element",["base/app","base","widgets/form/validator","text!./inputView.html"],function(e,t,n,r){var i=".control-group",s=".control-label",o=".help-inline",u="error",a=t.Model.extend({constructor:function(){t.Model.apply(this,arguments);var e=this,n=e.collection,r=e.get("activeRules");_.each(r,function(t){var r=n.get(t.element);r.on("change:value",function(t,n){e.updateActive()}),e.updateActive()})},defaults:{valid:!0,active:!0,disabled:!1,readonly:!1,skipPost:!1,value:null,label:null,activeRules:[],validationRules:[],type:"text",errorCode:"",group:"elements"},idAttribute:"name",updateActive:function(){var e=this.get("activeRules"),t=_.every(e,function(e){var t=this.collection.get(e.element);return c[e.expr].call(this,t,e)},this);this.set("active",t)},isElementValid:function(e){var t=this.get("validationRules"),r=[];if(this.isNot("active"))return[];var i,s=_.every(t,function(e){var t=n.validationRuleMethods[e.expr].call(this,e,this.get("value"));return t||(r.push(e),i=e),t},this);this.set("valid",s);if(!e)if(i){var o=i.message||"error."+this.get("name")+"."+i.expr;this.set("errorCode",o)}else this.set("errorCode","");return r},getSiblingValue:function(e){if(this.collection)return this.collection.get(e).get("value")},getSiblingAttribute:function(e,t){if(this.collection)return this.collection.get(e).get(t)},setSiblingAttribute:function(e,t,n){if(this.collection)return this.collection.get(e).set(t,n)},setSiblingValue:function(e,t){if(this.collection)return this.collection.get(e).set("value",t)},isElementDefault:function(){var e=this.toJSON();return e.value===e.defaultValue}}),f=t.Collection.extend({model:a}),l=t.View.extend({tagName:"div",className:"element",template:r,dataEvents:{forceRender:"render"},postRender:function(){this.syncAttributes()},syncAttributes:function(){var e=this.model,t=e.toJSON();_.each(t,function(t,n){var r=this[n+"ChangeHandler"];r&&typeof r=="function"&&r.call(this,e.get(n))},this),this.updateValue(!0)},disabledChangeHandler:function(e){this.$el.toggleClass("disabled",e),this.$("input").attr("disabled",e)},readonlyChangeHandler:function(e){this.$el.toggleClass("readonly",e),this.$("input").attr("readonly",e)},validChangeHandler:function(e){this.$(i).toggleClass(u,!e)},activeChangeHandler:function(e){this.$el.toggle(e)},valueChangeHandler:function(e){this.$("input").val(e),this.model.updateActive()},errorCodeChangeHandler:function(t){var n=this.$(o);t===""?(n.empty(),this.model.set("valid",!0)):(this.model.set("valid",!1),n.html(e.getString(t)))},nameChangeHandler:function(e){this.$el.addClass("element-"+e)},valueFunction:function(){return this.$("input").val()},updateValue:function(e){this.model.set("value",this.valueFunction()),e!==!0&&this.model.isElementValid()}}),c={eq:function(e,t){return e.isEqual("value",t.value)},valid:function(e){return e.isElementValid(!0),e.is("valid")},isIn:function(e,t){var n=e.get("value");return t.value.indexOf(n)!==-1},neq:function(e,t){return e.isNotEqual("value",t.value)},"function":function(e,t){var n=t.func;return n.apply(this,arguments)}};return{View:l,Model:a,Collection:f}}),define("text!widgets/messageStack/messageStack.html",[],function(){return"<div>\n\n</div>"}),define("widgets/messageStack",["base","text!./messageStack/messageStack.html"],function(e,t){var n=e.View.extend({template:t}),r=e.Model.extend({removeAllMessages:function(){}});return{View:n,Model:r}}),define("widgets/calendar/month",["base"],function(e){var t=e.app.compileTemplate('<td><a href="#selectDate" data-date="{{date}}" data-month="{{month}}" data-year="{{year}}" class="day action {{#if isToday}}today{{/if}} {{#if isSelected}}selected{{/if}}{{#if isDisabled}}disabled{{/if}}">{{date}}</a> </td>'),n=e.View.extend({className:"month",template:'<a href="#prevMonth" class="action but-prev"> < </a><div class="month-name">{{monthName month}}-{{year}}</div> <a href="#nextMonth" class="action but-next"> > </a> ',postRender:function(){var e=$("<table></table>"),n=this.model.toJSON(),r=this.getDate().startOf("week"),i=0,s,o=!1,u=!1,a=!1,f=moment().startOf("day").valueOf(),l=n.selectedEpoch;while(i<42){var c=r.day();c===0&&(s=$("<tr></tr>"),e.append(s)),r.valueOf()===f?o=!0:o=!1,r.valueOf()===l?u=!0:u=!1,r.month()!==n.month?a=!0:a=!1,s.append(t({date:r.date(),month:r.month(),year:r.year(),isToday:o,isSelected:u,isDisabled:a})),r.add("days",1),i++}this.$el.append(e)},getDate:function(){var e=this.model.toJSON();return moment({y:e.year,M:e.month,d:1})},changeHandler:function(){this.render()},actionHandler:function(e,t){switch(e){case"prevMonth":var n=this.getDate();n.add("months",-1),this.model.set({month:n.month(),year:n.year()});break;case"nextMonth":var n=this.getDate();n.add("months",1),this.model.set({month:n.month(),year:n.year()});break;case"selectDate":var r=$(t.target),i=r.data(),n=moment({y:i.year,M:i.month,d:i.date});this.model.set("selectedEpoch",n.valueOf()),this.trigger("dateClicked",n);break;default:alert("unhandled action: "+e)}}}),r=e.Model.extend({defaults:{month:moment().month(),year:moment().year(),selectedEpoch:moment().startOf("day").valueOf()}});return{View:n,Model:r}}),define("widgets/calendar",["require","widgets/calendar/month"],function(e){return{Month:e("widgets/calendar/month")}}),define("text!widgets/form/checkListView.html",[],function(){return'<div class="control-group">\n    <label class="control-label">\n        {{elementLabel this}}\n    </label>\n\n    <ul class="controls list-inline">\n        {{#each options}}\n        <li>\n        <label class="type-checkbox inline">\n            <input type="checkbox" name="{{id}}" value="{{id}}" class="el-{{name}}"/>{{name}}\n        </label>\n        </li>\n        {{/each}}\n    </ul>\n    <span class="help-inline"></span>\n</div>'}),define("text!widgets/form/checkBoxView.html",[],function(){return'<div class="control-group">\n    <div class="controls">\n        <label class="type-{{type}} inline">\n            <input type="{{type}}" name="{{id}}" value="{{id}}" class="el-{{name}}"/>{{elementLabel this}}\n        </label>\n        <span class="help-inline"></span>\n    </div>\n</div>'}),define("text!widgets/form/radioListView.html",[],function(){return'<div class="control-group">\n    <label class="control-label">\n        {{elementLabel this}}\n    </label>\n\n    <ul class="controls list-inline">\n        {{#each options}}\n        <li>\n        <label class="type-radio inline">\n            <input type="radio" name="{{../name}}" value="{{id}}" class="el-{{name}}"/>{{name}}\n        </label>\n        </li>\n        {{/each}}\n    </ul>\n    <span class="help-inline"></span>\n</div>'}),define("text!widgets/form/selectView.html",[],function(){return'<div class="control-group">\n    <label class="control-label">\n        {{elementLabel this}}\n    </label>\n\n    <div class="controls">\n        <div class="styled_select">\n            <em class="down-arrow">&#9660;</em>\n        <select name="{{name}}" class="el-{{name}}">\n            {{#each options}}\n            <option value="{{id}}">{{name}}</option>\n            {{/each}}\n        </select>\n        </div>\n        <span class="help-inline"></span>\n\n    </div>\n</div>'}),define("text!widgets/form/textAreaView.html",[],function(){return'<div class="control-group">\n    <label class="control-label">\n        {{elementLabel this}}\n    </label>\n\n    <div class="controls">\n        <textarea type="{{type}}" name="{{name}}" class="el-{{name}}" placeholder="{{placeholder}}">{{value}}</textarea>\n        <span class="help-inline"></span>\n    </div>\n</div>'}),define("text!widgets/form/buttonView.html",[],function(){return'<div class="control-group">\n    <div class="controls">\n        <button type="submit" class="btn btn-default">{{value}}</button>\n        <span class="help-inline"></span>\n    </div>\n</div>'}),define("text!widgets/form/dateInputView.html",[],function(){return'<div class="control-group">\n    <label class="control-label">\n        {{elementLabel this}}\n    </label>\n\n    <div class="controls type-{{type}}">\n        <input type="text" name="{{name}}" value="{{value}}" placeholder="{{placeholder}}" class="el-{{name}} dateInput">\n        <div class="monthView"></div>\n        <span class="help-inline"></span>\n    </div>\n</div>'}),define("text!widgets/form/messageView.html",[],function(){return'<div class="control-group">\n    <div class="message">{{value}}\n    </div>\n</div>'}),define("widgets/form",["base/app","base/util","base","widgets/form/element","widgets/messageStack","widgets/calendar","text!./form/checkListView.html","text!./form/checkBoxView.html","text!./form/radioListView.html","text!./form/selectView.html","text!./form/textAreaView.html","text!./form/buttonView.html","text!./form/dateInputView.html","text!./form/messageView.html"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=r.View,v=r.Model,m=r.Collection,g=d.extend({template:c,valueFunction:function(){return},valueChangeHandler:function(e){return}}),y=d.extend({events:{"change input":"updateValue","blur input":"resetIfEmpty","focus input":"selectIfDefault","click input":"clearIfDefault"},selectIfDefault:function(){this.model.isElementDefault()&&this.$("input").select()},clearIfDefault:function(){this.model.isElementDefault()&&this.$("input").val("")},resetIfEmpty:function(){var e=this.$("input").val();if(e===""){var t=this.model.toJSON();t.defaultValue&&this.$("input").val(t.defaultValue)}this.updateValue()}}),b=y.extend({template:h,events:{"click .dateInput":"showDatePicker","change .dateInput":"dateChangeHandler"},postRender:function(){this.hideDatePicker()},showDatePicker:function(){var e=this,n=this.getSubView("monthView");n||(n=t.createView({View:s.Month.View,Model:s.Month.Model,parentEl:".monthView",parentView:this}),this.setSubView("monthView",n),this.listenTo(n,"dateClicked",function(t){e.hideDatePicker(),e.$(".dateInput").val(t.format("L")),e.updateValue()}));var r=this.model.get("value"),i=moment(r,"MM/DD/YYYY");n.model.set({year:i.year(),month:i.month(),selectedEpoch:i.valueOf()});var o=this.$el,u=$("body"),a=this.$(".monthView"),f="click.clickOutSite_"+this.cid;a.show(),u.off(f),u.on(f,function(e){var t=$(e.target);if(t.parents().index(u)==-1&&!t.is(u))return;t.parents().index(o)==-1&&a.is(":visible")&&(a.hide(),$("body").off(f))})},hideDatePicker:function(){var e="click.clickOutSite_"+this.cid;this.$(".monthView").hide(),$("body").off(e)},valueFunction:function(){return this.$(".dateInput").val()},valueChangeHandler:function(e){var t=moment(e,"MM/DD/YYYY");t.isValid()||(t=moment(),this.model.set("value",t.format("L"))),this.$(".dateInput").val(t.format("L"))},dateChangeHandler:function(){var e=this.$(".dateInput").val(),t=moment(e,"MM/DD/YYYY");t.isValid()?(this.model.set("value",e),this.hideDatePicker()):this.valueChangeHandler(this.model.get("value"))}}),w=y.extend({template:u,valueFunction:function(){return this.$("input").is(":checked")},valueChangeHandler:function(e){this.$("input").attr("checked",e)}}),E=d.extend({template:l,events:{"change textarea":"updateValue","blur textarea":"updateValue"},valueFunction:function(){return this.$("textarea").val()},valueChangeHandler:function(e){this.$("textarea").val(e)}}),S=d.extend({template:f,events:{"change select":"updateValue","blur select":"updateValue"},valueFunction:function(){return this.$("select").val()},valueChangeHandler:function(e){this.$("select").val(e)},disabledChangeHandler:function(e){this.$el.toggleClass("disabled",e),this.$("select").attr("disabled",e)}}),x=y.extend({events:{"change input":"updateValue"},template:a,valueFunction:function(){return this.$("input:checked").val()},valueChangeHandler:function(e){if(e==="")return;this.$("input[value="+e+"]").prop("checked","checked")}}),T=y.extend({template:o,valueFunction:function(){var e=this.$("input:checked"),t=_.map(e,function(e){return $(e).val()});return t},valueChangeHandler:function(e){_.isArray(e)&&_.each(e,function(e){this.$("input[value="+e+"]").attr("checked",!0)},this)}}),N=d.extend({template:'<input type="hidden" value="{{value}}" name="{{name}}" />',valueChangeHandler:function(e){this.$("input").val(e),this.$("input").trigger("change")},valueFunction:function(){return""+this.$("input").val()}}),C=d.extend({template:" ",valueChangeHandler:function(e){},valueFunction:function(){}}),k=d.extend({template:p,valueChangeHandler:function(e){this.$(".message").html(e)},valueFunction:function(){return this.$(".message").html()}}),L=d.extend({template:'<input type="hidden" value="{{value}}" name="{{name}}" />',valueChangeHandler:function(e){this.$("input").val(JSON.stringify(e)),this.updateValue()},valueFunction:function(){return JSON.parse(this.$("input").val())}}),A=y.extend({valueFunction:function(){return this.$("input").is(":checked")},valueChangeHandler:function(e){this.$("input").attr("checked",e)}}),O={select:S,textarea:E,checkbox:w,dateInput:b,radioList:x,checkList:T,hidden:N,json:L,submit:g,message:k,container:C},M=function(e){return O[e]||y},D=function(e,t){O[e]=t},P=function(e){O=_.extend({},O,e)},H=n.Model.extend({constructor:function(){n.Model.apply(this,arguments)},defaults:{elements:new m},setElementAttribute:function(e,t,n){var r=this.get("elements");r.get(e).set(t,n)},getValueObject:function(){var e=this.get("elements"),t=this.validateElements(),n={};return t.length===0?e.each(function(e){e.is("active")&&e.isNot("skipPost")&&(n[e.id]=e.get("value"))}):n.errors=t,n},validateElements:function(){var e=this.get("elements"),t=[];return e.each(function(e){t=t.concat(e.isElementValid())}),t},elementsChangeHandler:function(){var e=this.get("elements");e.on("change",function(e){var t="change",n=Array.prototype.slice.call(arguments,[0]);n[0]="elements:"+t,this.trigger.apply(this,n),n[0]="elements:"+e.get("name")+":"+t,this.trigger.apply(this,n)},this)}}),B="grp-",j=n.View.extend({constructor:function(e){this.typeViewIndex={},n.View.apply(this,arguments)},tagName:"div",className:"form-view",events:{"submit form":"formSubmitHandler"},template:'<div class="form-message-container"></div><form action="{{actionId}}" class="form-vertical" method=""> <div class="group-list"></div> <div class="grp-buttons"> </div> </form>',postRender:function(){this.formEl=this.$("form"),this.renderGroupContainers(),this.renderMessageStack();var e=this.model,t=e.get("elements");this.$el.hide(),t.each(function(e){this.addElement(e)},this),this.$el.show()},addElement:function(e){var n=e.toJSON(),r=this,i=this.typeViewIndex[n.type]||M(n.type),s=n.name,o,u=this.$(".element-"+s);if(u.length!==0)o=new i({model:e,el:u}),o.postRender(),o.syncAttributes();else{o=t.createView({View:i,model:e,parentView:r});var a=n.group;this.$("."+B+a).append(o.render().el)}},removeElement:function(e){},renderGroupContainers:function(){var e=this.model,t=e.get("elements"),n=_.unique(t.pluck("group")),r=this.$(".group-list");_.each(n,function(e){this.$("."+B+e).length===0&&r.append('<div class="'+B+e+'"></div>')},this)},renderMessageStack:function(){var e=new i.Model,t=new i.View({model:e,el:this.$(".form-message-container")});t.render(),this.on("showMessages",function(t){e.removeAllMessages(),_.each(t,function(t){var n=new i.Model(t);e.addMessage(n.toJSON())})}),this.on("clearMessages",function(t){e.removeAllMessages()})},formSubmitHandler:function(e){e.preventDefault(),this.trigger("clearMessages");var t=this.model.getValueObject(),n=this.model.get("actionId");this.options.prePostParser&&(t=this.options.prePostParser(t)),this.trigger("formSubmit",t)},addToTypeViewIndex:function(e,t){this.typeViewIndex[e]=t},submitSuccessHandler:function(){console.log(arguments)},submitFailureHandler:function(e,t){_.each(t,function(e){e.messageType="failure",e.expires=0}),this.trigger("showMessages",t)},setElementValue:function(e,t){var n=this.model.get("elements");n.get(e).set("value",t)}});return j.addToTypeViewIndex=function(e,t){D(e,t)},{Model:H,View:j,ElementModel:v,ElementCollection:m,ElementView:d}}),define("widgets/tab",["base/app","base","list/singleSelect"],function(e,t,n){var r=t.util,i=t.View.extend({tagName:"li",template:'<a href="#{{id}}" class="action">{{name}}</a>',changeHandler:function(){this.$el.toggleClass("active",this.model.is("selected"))}}),s=t.View.extend({changeHandler:function(){this.$el.toggle(this.model.is("selected"))}}),o=n.View.extend({template:'<div class="prop-tabs"><ul class="ib-list"></ul></div><div class="tab-panes"></div> ',postRender:function(){var e=this,n=this.model.get("items"),o=r.createView({View:t.CollectionView,collection:n,el:e.$(".ib-list"),itemView:i,parentView:e}),u=r.createView({View:t.CollectionView,tagName:"div",collection:n,el:e.$(".tab-panes"),itemView:s,parentView:e})},actionHandler:function(e){this.model.setSelectedById(e)}});return{View:o,Model:n.Model}}),define("widgets",["require","widgets/form","widgets/calendar","widgets/header","widgets/messageStack","widgets/tab"],function(e){return{Form:e("widgets/form"),Calender:e("widgets/calendar"),Header:e("widgets/header"),MessageStack:e("widgets/messageStack"),Tab:e("widgets/tab")}});