define(["base/app","base/view","base/model","base/configurableModel","base/collection","base/util","widgets/table/rowCollection","widgets/table/pagination"],function(e,t,n,r,i,s,o,u){var a=n.extend({}),f=t.extend({tagName:"tr",className:"table-row",template:'{{#each items}}<td data-key="{{key}}" class="{{classNames}}" style="width:{{width}}"><div class="cell-value" style="text-align: {{align}};">{{#if renderHTML}}{{{value}}}{{else}}{{value}}{{/if}}</div></td>{{/each}}',useDeepJSON:!0}),l=f.extend({className:"table-heading",template:'{{#each items}}<th data-key="{{key}}" class="{{classNames}}"  style="width:{{width}}"><div class="cell-value" style="text-align: {{align}}">{{value}}</div></th>{{/each}}'}),c=function(){var t=this,r={},o=this.$el,u=this.getOption("rowCollection"),a=this.getOption("columns");t.addItem=function(o,l,c){var h=u.getConfig("sortOrder"),p=u.getConfig("sortKey"),d=_.map(a,function(t){var n=["cell"];p===t.key&&(n.push("sorted"),n.push("order-"+h)),l%2===0&&n.push("even");var r=o.toJSON();return{key:t.key,classNames:n.join(" "),value:e.getFormatted(r[t.key],t.formatter,r),align:t.align||"left",width:t.width?t.width+"px":"auto",renderHTML:t.renderHTML}}),v=new n({items:new i(d)}),m=s.createView({model:v,View:f,parentView:t});r[m.cid]=m,m.$el.appendTo(c)},t.addHeaderItem=function(o){var f=u.getConfig("sortOrder"),c=u.getConfig("sortKey"),h=_.map(a,function(t){var n=["header-cell"];return t.sortable!==!1&&n.push("sortable"),c===t.key&&(n.push("sorted"),n.push("order-"+f)),{key:t.key,classNames:n.join(" "),value:t.label||e.beautifyId(t.key),align:t.align||"left",width:t.width?t.width+"px":"auto"}}),p=new n({items:new i(h)}),d=s.createView({View:l,model:p,parentEl:o,parentView:t});r[d.cid]=d},t.removeItem=function(e){var n=t.getModelViewAt(e.id);n.remove()},t.removeAllRows=function(){_.each(r,function(e,t){e.remove()})},t.getModelViewAt=function(e){return r[e]},t.removeReferences(function(){t=null,r=null,o=null,u=null})},h=t.extend({template:'<div class="table-header"></div> <table class="row-list"></table><div class="table-footer"></div>',className:"data-table",events:{"click th.sortable":"toggleSort"},constructor:function(e){var n=this;t.call(n,e),_.each([c],function(t){t.call(n,e)});var r=this.getOption("rowCollection");n.listenTo(r,"config_change",n.loadRows),n.listenTo(r,"reset",function(){n.redrawTable()})},redrawTable:function(){this.removeAllRows(),this.renderHeader(),this.renderRows()},postRender:function(){this.loadRows()},loadRows:function(){var e=this,t=this.$el,n=this.getOption("rowCollection");t.hide();var r=n.getConfigs();if(r.requestId){var i=e.addRequest({id:r.requestId,params:r});i.done(function(e){n.setConfig("totalRecords",e.totalRecords),n.reset(e.results)})}else n.url?n.fetch({processData:!0,reset:!0}):e.redrawTable();t.show()},renderRows:function(){var e=this,t=e.getOption("rowCollection"),n=t.getProcessedRecords(),r=this.$(".row-list");n.length===0?e.renderNoData():_.each(n,function(t,n){e.addItem(t,n,r)})},renderNoData:function(){var t=this,n=this.getOption("noDataTemplate")||"No Records",r=this.$(".row-list"),i=this.getOption("columns");e.getTemplateDef(n,t.getTemplateType()).done(function(e){var t=$("<td></td>").prop("colspan",i.length);t.html(e({}));var n=$('<tr class="table-row no-data-row"></tr>').appendTo(r);t.appendTo(n)})},renderHeader:function(){var e=this,t=this.$(".row-list");e.addHeaderItem(t)},loadingHandler:function(e){t.prototype.loadingHandler.call(this,e)},toggleSort:function(e){var t=$(e.currentTarget),n=t.data("key");this.getOption("rowCollection").setSortKey(n)}});return{View:h,RowCollection:o,Model:a}});