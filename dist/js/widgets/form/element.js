define(["base/app","base","widgets/form/validator","text!./inputView.html"],function(e,t,n,r){var i=".control-group",s=".control-label",o=".help-inline",u="error",a=t.Model.extend({defaults:{valid:!0,active:!0,disabled:!1,readonly:!1,value:null,label:null,activeRules:[],validationRules:[],type:"text",errorCode:"",group:"elements"},idAttribute:"name",updateActive:function(){var e=this.get("activeRules"),t=_.every(e,function(e){var t=this.collection.get(e.element);return c[e.expr].call(null,t,e)},this);this.set("active",t)},isElementValid:function(e){var t=this.get("validationRules"),r=[];if(this.isNot("active"))return[];var i,s=_.every(t,function(e){var t=n.validationRuleMethods[e.expr].call(this,e,this.get("value"));return t||(r.push(e),i=e),t},this);this.set("valid",s);if(!e)if(i){var o=i.message||"error."+this.get("name")+"."+i.expr;this.set("errorCode",o)}else this.set("errorCode","");return r},getSiblingValue:function(e){if(this.collection)return this.collection.get(e).get("value")},getSiblingAttribute:function(e,t){if(this.collection)return this.collection.get(e).get(t)},setSiblingAttribute:function(e,t,n){if(this.collection)return this.collection.get(e).set(t,n)},setSiblingValue:function(e,t){if(this.collection)return this.collection.get(e).set("value",t)}}),f=t.Collection.extend({model:a}),l=t.View.extend({tagName:"div",className:"element",events:{"change input":"updateValue","blur input":"updateValue",click:"setFocus"},template:r,postRender:function(){this.syncAttributes()},syncAttributes:function(){var e=this.model,t=e.toJSON();_.each(t,function(t,n){var r=this[n+"ChangeHandler"];r&&typeof r=="function"&&r.call(this,e.get(n))},this),this.updateValue(!0)},disabledChangeHandler:function(e){this.$el.toggleClass("disabled",e),this.$("input").attr("disabled",e)},readonlyChangeHandler:function(e){this.$el.toggleClass("readonly",e),this.$("input").attr("readonly",e)},validChangeHandler:function(e){this.$(i).toggleClass(u,!e)},activeChangeHandler:function(e){this.$el.toggle(e)},valueChangeHandler:function(e){this.$("input").val(e)},errorCodeChangeHandler:function(t){var n=this.$(o);t===""?(n.empty(),this.model.set("valid",!0)):(this.model.set("valid",!1),n.html(e.getString(t)))},nameChangeHandler:function(e){this.$el.addClass("element-"+e)},valueFunction:function(){return this.$("input").val()},updateValue:function(e){this.model.set("value",this.valueFunction()),e!==!0&&this.model.isElementValid()},setFocus:function(){var e=this.$el.closest("form");e.find(".focused").removeClass("focused"),this.$el.addClass("focused")},removeFocus:function(){this.$el.removeClass("focused")}}),c={eq:function(e,t){return e.isEqual("value",t.value)},valid:function(e){return e.isElementValid(!0),e.is("valid")},isIn:function(e,t){var n=e.get("value");return t.value.indexOf(n)!==-1},neq:function(e,t){return e.isNotEqual("value",t.value)},"function":function(e,t){var n=t.func;return n.apply(null,arguments)}};return{View:l,Model:a,Collection:f}});